[Unit]
Description=User API Application Service
After=network.target mysql.service

[Service]
# User and Group to run the application as
User=vagrant
Group=vagrant

# Use the virtual environment Python executable
ExecStart=/opt/userapi_venv/bin/python {{ app_directory }}/app.py
WorkingDirectory={{ app_directory }}
Restart=always
Environment="PYTHONUNBUFFERED=1"
# Environment variables for the app to connect to the DB
Environment="MYSQL_HOST=127.0.0.1" # DB is running on the same VM
Environment="MYSQL_USER=root"
Environment="MYSQL_PASSWORD={{ mysql_root_password }}"
Environment="MYSQL_DB=devops_userdb"
Environment="FLASK_APP=app.py"


[Install]
WantedBy=multi-user.target